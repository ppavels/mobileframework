!function(e,t,i){"use strict";t.infinitescroll=function(e,i,o){this.element=t(o),this._create(e,i)||(this.failed=!0)},t.infinitescroll.defaults={loading:{finished:i,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"../../public/img/loading.gif",msg:null,msgText:"",selector:null,speed:"fast",start:i},state:{isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,isBeyondMaxPage:!1,currPage:1},debug:!1,behavior:i,binder:t(e),nextSelector:"div.navigation a:first",navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:!1,pathParse:i,dataType:"html",appendCallback:!0,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:i,path:i,prefill:!1,maxPage:i},t.infinitescroll.prototype={_binding:function(e){var t=this,o=t.options;return o.v="2.0b2.120520",o.behavior&&this["_binding_"+o.behavior]!==i?void this["_binding_"+o.behavior].call(this):"bind"!==e&&"unbind"!==e?(this._debug("Binding value  "+e+" not valid"),!1):("unbind"===e?this.options.binder.unbind("smartscroll.infscr."+t.options.infid):this.options.binder[e]("smartscroll.infscr."+t.options.infid,function(){t.scroll()}),void this._debug("Binding",e))},_create:function(o,n){var a=t.extend(!0,{},t.infinitescroll.defaults,o);this.options=a;var s=t(e),r=this;if(!r._validate(o))return!1;var l=t(a.nextSelector).attr("href");if(!l)return this._debug("Navigation selector not found"),!1;a.path=a.path||this._determinepath(l),a.contentSelector=a.contentSelector||this.element,a.loading.selector=a.loading.selector||a.contentSelector,a.loading.msg=a.loading.msg||t('<div id="infscr-loading"><img alt="Loading..." src="'+a.loading.img+'" /><div>'+a.loading.msgText+"</div></div>"),(new Image).src=a.loading.img,a.pixelsFromNavToBottom===i&&(a.pixelsFromNavToBottom=t(document).height()-t(a.navSelector).offset().top,this._debug("pixelsFromNavToBottom: "+a.pixelsFromNavToBottom));var c=this;return a.loading.start=a.loading.start||function(){t(a.navSelector).hide(),a.loading.msg.appendTo(a.loading.selector).show(a.loading.speed,t.proxy(function(){this.beginAjax(a)},c))},a.loading.finished=a.loading.finished||function(){a.state.isBeyondMaxPage||a.loading.msg.fadeOut(a.loading.speed)},a.callback=function(e,o,r){a.behavior&&e["_callback_"+a.behavior]!==i&&e["_callback_"+a.behavior].call(t(a.contentSelector)[0],o,r),n&&n.call(t(a.contentSelector)[0],o,a,r),a.prefill&&s.bind("resize.infinite-scroll",e._prefill)},o.debug&&(!Function.prototype.bind||"object"!=typeof console&&"function"!=typeof console||"object"!=typeof console.log||["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]=this.call(console[e],console)},Function.prototype.bind)),this._setup(),a.prefill&&this._prefill(),!0},_prefill:function(){function i(){return o.options.contentSelector.height()<=n.height()}var o=this,n=t(e);this._prefill=function(){i()&&o.scroll(),n.bind("resize.infinite-scroll",function(){i()&&(n.unbind("resize.infinite-scroll"),o.scroll())})},this._prefill()},_debug:function(){!0===this.options.debug&&("undefined"!=typeof console&&"function"==typeof console.log?console.log(1===Array.prototype.slice.call(arguments).length&&"string"==typeof Array.prototype.slice.call(arguments)[0]?Array.prototype.slice.call(arguments).toString():Array.prototype.slice.call(arguments)):Function.prototype.bind||"undefined"==typeof console||"object"!=typeof console.log||Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments)))},_determinepath:function(e){var t=this.options;if(t.behavior&&this["_determinepath_"+t.behavior]!==i)return this["_determinepath_"+t.behavior].call(this,e);if(t.pathParse)return this._debug("pathParse manual"),t.pathParse(e,this.options.state.currPage+1);if(e.match(/^(.*?)\b2\b(.*?$)/))e=e.match(/^(.*?)\b2\b(.*?$)/).slice(1);else if(e.match(/^(.*?)2(.*?$)/)){if(e.match(/^(.*?page=)2(\/.*|$)/))return e=e.match(/^(.*?page=)2(\/.*|$)/).slice(1);e=e.match(/^(.*?)2(.*?$)/).slice(1)}else{if(e.match(/^(.*?page=)1(\/.*|$)/))return e=e.match(/^(.*?page=)1(\/.*|$)/).slice(1);this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com."),t.state.isInvalidPage=!0}return this._debug("determinePath",e),e},_error:function(e){var t=this.options;return t.behavior&&this["_error_"+t.behavior]!==i?void this["_error_"+t.behavior].call(this,e):("destroy"!==e&&"end"!==e&&(e="unknown"),this._debug("Error",e),("end"===e||t.state.isBeyondMaxPage)&&this._showdonemsg(),t.state.isDone=!0,t.state.currPage=1,t.state.isPaused=!1,t.state.isBeyondMaxPage=!1,void this._binding("unbind"))},_loadcallback:function(o,n,a){var s,r=this.options,l=this.options.callback,c=r.state.isDone?"done":r.appendCallback?"append":"no-append";if(r.behavior&&this["_loadcallback_"+r.behavior]!==i)return void this["_loadcallback_"+r.behavior].call(this,o,n);switch(c){case"done":return this._showdonemsg(),!1;case"no-append":"html"===r.dataType&&(n="<div>"+n+"</div>",n=t(n).find(r.itemSelector));break;case"append":var d=o.children();if(0===d.length)return this._error("end");for(s=document.createDocumentFragment();o[0].firstChild;)s.appendChild(o[0].firstChild);this._debug("contentSelector",t(r.contentSelector)[0]),t(r.contentSelector)[0].appendChild(s),n=d.get()}if(r.loading.finished.call(t(r.contentSelector)[0],r),r.animate){var h=t(e).scrollTop()+t(r.loading.msg).height()+r.extraScrollPx+"px";t("html,body").animate({scrollTop:h},800,function(){r.state.isDuringAjax=!1})}r.animate||(r.state.isDuringAjax=!1),l(this,n,a),r.prefill&&this._prefill()},_nearbottom:function(){var o=this.options,n=0+t(document).height()-o.binder.scrollTop()-t(e).height();return o.behavior&&this["_nearbottom_"+o.behavior]!==i?this["_nearbottom_"+o.behavior].call(this):(this._debug("math:",n,o.pixelsFromNavToBottom),n-o.bufferPx<o.pixelsFromNavToBottom)},_pausing:function(e){var t=this.options;if(t.behavior&&this["_pausing_"+t.behavior]!==i)return void this["_pausing_"+t.behavior].call(this,e);switch("pause"!==e&&"resume"!==e&&null!==e&&this._debug("Invalid argument. Toggling pause value instead"),e=!e||"pause"!==e&&"resume"!==e?"toggle":e){case"pause":t.state.isPaused=!0;break;case"resume":t.state.isPaused=!1;break;case"toggle":t.state.isPaused=!t.state.isPaused}return this._debug("Paused",t.state.isPaused),!1},_setup:function(){var e=this.options;return e.behavior&&this["_setup_"+e.behavior]!==i?void this["_setup_"+e.behavior].call(this):(this._binding("bind"),!1)},_showdonemsg:function(){var e=this.options;return e.behavior&&this["_showdonemsg_"+e.behavior]!==i?void this["_showdonemsg_"+e.behavior].call(this):(e.loading.msg.find("img").hide().parent().find("div").html(e.loading.finishedMsg).animate({opacity:1},2e3,function(){t(this).parent().fadeOut(e.loading.speed)}),void e.errorCallback.call(t(e.contentSelector)[0],"done"))},_validate:function(e){for(var i in e)if(i.indexOf&&i.indexOf("Selector")>-1&&0===t(e[i]).length)return this._debug("Your "+i+" found no elements."),!1;return!0},bind:function(){this._binding("bind")},destroy:function(){return this.options.state.isDestroyed=!0,this.options.loading.finished(),this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},beginAjax:function(e){var o,n,a,s,r=this,l=e.path;if(e.state.currPage++,e.maxPage!=i&&e.state.currPage>e.maxPage)return e.state.isBeyondMaxPage=!0,void this.destroy();switch(o=t(t(e.contentSelector).is("table, tbody")?"<tbody/>":"<div/>"),n="function"==typeof l?l(e.state.currPage):l.join(e.state.currPage),r._debug("heading into ajax",n),a="html"===e.dataType||"json"===e.dataType?e.dataType:"html+callback",e.appendCallback&&"html"===e.dataType&&(a+="+callback"),a){case"html+callback":r._debug("Using HTML via .load() method"),o.load(n+" "+e.itemSelector,i,function(e){r._loadcallback(o,e,n)});break;case"html":r._debug("Using "+a.toUpperCase()+" via $.ajax() method"),t.ajax({url:n,dataType:e.dataType,complete:function(e,t){s="undefined"!=typeof e.isResolved?e.isResolved():"success"===t||"notmodified"===t,s?r._loadcallback(o,e.responseText,n):r._error("end")}});break;case"json":r._debug("Using "+a.toUpperCase()+" via $.ajax() method"),t.ajax({dataType:"json",type:"GET",url:n,success:function(t,a,l){if(s="undefined"!=typeof l.isResolved?l.isResolved():"success"===a||"notmodified"===a,e.appendCallback)if(e.template!==i){var c=e.template(t);o.append(c),s?r._loadcallback(o,c):r._error("end")}else r._debug("template must be defined."),r._error("end");else s?r._loadcallback(o,t,n):r._error("end")},error:function(){r._debug("JSON ajax request failed."),r._error("end")}})}},retrieve:function(e){e=e||null;var o=this,n=o.options;return n.behavior&&this["retrieve_"+n.behavior]!==i?void this["retrieve_"+n.behavior].call(this,e):n.state.isDestroyed?(this._debug("Instance is destroyed"),!1):(n.state.isDuringAjax=!0,void n.loading.start.call(t(n.contentSelector)[0],n))},scroll:function(){var e=this.options,t=e.state;return e.behavior&&this["scroll_"+e.behavior]!==i?void this["scroll_"+e.behavior].call(this):void(t.isDuringAjax||t.isInvalidPage||t.isDone||t.isDestroyed||t.isPaused||this._nearbottom()&&this.retrieve())},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))}},t.fn.infinitescroll=function(e,i){var o=typeof e;switch(o){case"string":var n=Array.prototype.slice.call(arguments,1);this.each(function(){var i=t.data(this,"infinitescroll");return i&&t.isFunction(i[e])&&"_"!==e.charAt(0)?void i[e].apply(i,n):!1});break;case"object":this.each(function(){var o=t.data(this,"infinitescroll");o?o.update(e):(o=new t.infinitescroll(e,i,this),o.failed||t.data(this,"infinitescroll",o))})}return this};var o,n=t.event;n.special.smartscroll={setup:function(){t(this).bind("scroll",n.special.smartscroll.handler)},teardown:function(){t(this).unbind("scroll",n.special.smartscroll.handler)},handler:function(e,i){var n=this,a=arguments;e.type="smartscroll",o&&clearTimeout(o),o=setTimeout(function(){t(n).trigger("smartscroll",a)},"execAsap"===i?0:100)}},t.fn.smartscroll=function(e){return e?this.bind("smartscroll",e):this.trigger("smartscroll",["execAsap"])}}(window,jQuery);